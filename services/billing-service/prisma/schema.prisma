generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Facture {
  id             String          @id @default(uuid())
  numeroFacture  String          @unique
  clientId       String
  dateEmission   DateTime        @default(now())
  dateEcheance   DateTime
  montantHT      Float
  montantTVA     Float
  montantTTC     Float
  status         FactureStatus   @default(BROUILLON)
  notes          String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  lignes         LigneFacture[]
  paiements      Paiement[]

  @@index([clientId])
  @@index([status])
  @@index([dateEmission])
  @@map("factures")
}

model LigneFacture {
  id            String   @id @default(uuid())
  factureId     String
  description   String
  quantite      Float
  prixUnitaire  Float
  tauxTVA       Float
  montantHT     Float
  montantTVA    Float
  montantTTC    Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  facture       Facture  @relation(fields: [factureId], references: [id], onDelete: Cascade)

  @@index([factureId])
  @@map("lignes_facture")
}

model Paiement {
  id               String          @id @default(uuid())
  factureId        String
  montant          Float
  datePaiement     DateTime        @default(now())
  methodePaiement  MethodePaiement
  reference        String?
  notes            String?
  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt

  facture          Facture         @relation(fields: [factureId], references: [id], onDelete: Cascade)

  @@index([factureId])
  @@index([datePaiement])
  @@map("paiements")
}

model Devis {
  id            String       @id @default(uuid())
  numeroDevis   String       @unique
  clientId      String
  dateEmission  DateTime     @default(now())
  dateValidite  DateTime
  montantHT     Float
  montantTVA    Float
  montantTTC    Float
  status        DevisStatus  @default(BROUILLON)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  lignes        LigneDevis[]

  @@index([clientId])
  @@index([status])
  @@index([dateEmission])
  @@map("devis")
}

model LigneDevis {
  id            String   @id @default(uuid())
  devisId       String
  description   String
  quantite      Float
  prixUnitaire  Float
  tauxTVA       Float
  montantHT     Float
  montantTVA    Float
  montantTTC    Float
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  devis         Devis    @relation(fields: [devisId], references: [id], onDelete: Cascade)

  @@index([devisId])
  @@map("lignes_devis")
}

enum FactureStatus {
  BROUILLON
  EMISE
  PAYEE
  EN_RETARD
  ANNULEE
}

enum DevisStatus {
  BROUILLON
  ENVOYE
  ACCEPTE
  REFUSE
  EXPIRE
}

enum MethodePaiement {
  VIREMENT
  CHEQUE
  CARTE
  ESPECES
}
