generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Message {
  id              String   @id @default(uuid())
  expediteurId    String
  destinataireId  String
  sujet           String
  contenu         String   @db.Text
  type            TypeMessage
  status          StatusMessage @default(BROUILLON)
  dateEnvoi       DateTime?
  dateLu          DateTime?
  pieceJointe     String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("messages")
}

model Template {
  id              String   @id @default(uuid())
  nom             String
  sujet           String
  contenu         String   @db.Text
  type            TypeMessage
  variables       Json?
  actif           Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  campagnes       CampagneMail[]

  @@map("templates")
}

model Notification {
  id              String   @id @default(uuid())
  userId          String
  titre           String
  message         String   @db.Text
  type            TypeNotification @default(INFO)
  lue             Boolean  @default(false)
  dateCreation    DateTime @default(now())
  dateLu          DateTime?

  @@map("notifications")
}

model CampagneMail {
  id              String   @id @default(uuid())
  nom             String
  templateId      String
  destinataires   Json
  dateEnvoi       DateTime?
  status          StatusCampagne @default(BROUILLON)
  nbEnvoyes       Int      @default(0)
  nbLus           Int      @default(0)
  nbErreurs       Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  template        Template @relation(fields: [templateId], references: [id])

  @@map("campagnes_mail")
}

enum TypeMessage {
  EMAIL
  SMS
  NOTIFICATION
}

enum StatusMessage {
  BROUILLON
  ENVOYE
  LU
  ARCHIVE
}

enum TypeNotification {
  INFO
  WARNING
  ERROR
  SUCCESS
}

enum StatusCampagne {
  BROUILLON
  PROGRAMMEE
  EN_COURS
  TERMINEE
  ANNULEE
}
