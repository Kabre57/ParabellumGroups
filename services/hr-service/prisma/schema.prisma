generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Employe {
  id            String      @id @default(uuid())
  matricule     String      @unique
  nom           String
  prenom        String
  email         String      @unique
  telephone     String?
  dateEmbauche  DateTime
  poste         String
  departement   String
  salaire       Decimal     @db.Decimal(10, 2)
  status        StatusEmploye @default(ACTIF)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  conges        Conge[]     @relation("EmployeConges")
  congesApprouves Conge[]   @relation("ApprobateurConges")
  presences     Presence[]
  evaluations   Evaluation[] @relation("EmployeEvaluations")
  evaluationsRealisees Evaluation[] @relation("EvaluateurEvaluations")

  @@map("employes")
}

enum StatusEmploye {
  ACTIF
  CONGE
  MALADIE
  DEMISSION
}

model Conge {
  id              String      @id @default(uuid())
  employeId       String
  typeConge       TypeConge
  dateDebut       DateTime
  dateFin         DateTime
  nbJours         Int
  motif           String?
  status          StatusConge @default(DEMANDE)
  approbateurId   String?
  dateApprobation DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  employe         Employe     @relation("EmployeConges", fields: [employeId], references: [id], onDelete: Cascade)
  approbateur     Employe?    @relation("ApprobateurConges", fields: [approbateurId], references: [id])

  @@map("conges")
}

enum TypeConge {
  ANNUEL
  MALADIE
  SANS_SOLDE
  PARENTAL
}

enum StatusConge {
  DEMANDE
  APPROUVE
  REJETE
  ANNULE
}

model Presence {
  id            String      @id @default(uuid())
  employeId     String
  date          DateTime
  heureArrivee  DateTime?
  heureDepart   DateTime?
  duree         Decimal?    @db.Decimal(5, 2)
  type          TypePresence @default(BUREAU)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  employe       Employe     @relation(fields: [employeId], references: [id], onDelete: Cascade)

  @@unique([employeId, date])
  @@map("presences")
}

enum TypePresence {
  BUREAU
  TELETRAVAIL
  DEPLACEMENT
  ABSENCE
}

model Evaluation {
  id              String      @id @default(uuid())
  employeId       String
  evaluateurId    String
  dateEvaluation  DateTime
  periode         String
  noteGlobale     Decimal     @db.Decimal(3, 2)
  competences     Json
  commentaires    String?
  objectifs       Json?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  employe         Employe     @relation("EmployeEvaluations", fields: [employeId], references: [id], onDelete: Cascade)
  evaluateur      Employe     @relation("EvaluateurEvaluations", fields: [evaluateurId], references: [id])

  @@map("evaluations")
}
